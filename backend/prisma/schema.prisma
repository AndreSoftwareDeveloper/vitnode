// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model core_languages {
  id        String  @id @unique @db.VarChar(32)
  name      String  @db.VarChar(255)
  timezone  String  @default("UTC") @db.VarChar(255)
  protected Boolean @default(false)
  default   Boolean @default(false)
  enabled   Boolean @default(true)
  created   Int

  groups                    core_groups_languages[]    @relation("core_groups_languages_language")
  forums_forums_names       forum_forums_names[]       @relation("forums_forums_names_language")
  forums_forums_description forum_forums_description[] @relation("forums_forums_description_language")
}

model core_members {
  id                   String            @id @unique @db.VarChar(255)
  name                 String            @unique @db.VarChar(255)
  email                String            @unique @db.VarChar(255)
  password             String            @db.Text
  group                core_groups       @relation("core_members_group", references: [id], fields: [group_id])
  group_id             String
  joined               Int
  birthday             Int
  avatar               core_attachments? @relation("core_members_avatar", fields: [avatar_id], references: [id])
  avatar_id            String?           @unique @db.VarChar(255)
  cover                core_attachments? @relation("core_members_cover", fields: [cover_id], references: [id])
  cover_id             String?           @unique @db.VarChar(255)
  posts                Int               @default(0)
  followers            Int               @default(0)
  reactions            Int               @default(0)
  newsletter           Boolean           @default(false)
  avatar_color         String            @db.VarChar(6)
  unread_notifications Int               @default(0)

  attachments       core_attachments[]       @relation("core_attachments_member")
  sessions          core_sessions[]          @relation("core_sessions_member")
  admin_sessions    core_admin_sessions[]    @relation("core_admin_sessions_member")
  admin_permissions core_admin_permissions[] @relation("core_admin_permissions_member")

  @@index([group_id])
}

model core_groups {
  id        String                  @id @unique @default(uuid())
  name      core_groups_languages[] @relation("core_groups_languages_group")
  created   Int
  updated   Int
  protected Boolean                 @default(false)
  default   Boolean                 @default(false)
  root      Boolean                 @default(false)
  guest     Boolean                 @default(false)

  members           core_members[]           @relation("core_members_group")
  admin_permissions core_admin_permissions[] @relation("core_admin_permissions_group")
}

model core_groups_languages {
  id          String @id @unique @default(uuid())
  id_language String @db.VarChar(32)
  group_id    String
  value       String @db.VarChar(255)

  group    core_groups    @relation("core_groups_languages_group", references: [id], fields: [group_id], onDelete: Cascade)
  language core_languages @relation("core_groups_languages_language", references: [id], fields: [id_language])

  @@index([id_language])
}

model core_admin_permissions {
  id          String        @id @unique @default(uuid())
  group       core_groups?  @relation("core_admin_permissions_group", references: [id], fields: [group_id])
  group_id    String?
  member      core_members? @relation("core_admin_permissions_member", references: [id], fields: [member_id])
  member_id   String?
  permissions String        @db.Text
  created     Int
  updated     Int
}

model core_sessions {
  refresh_token        String       @id @unique @db.VarChar(255)
  access_token         String?      @unique @db.VarChar(255)
  member               core_members @relation("core_sessions_member", references: [id], fields: [member_id])
  member_id            String
  ip_address           String?      @db.VarChar(46)
  user_agent           String       @db.Text
  uagent_browser       String       @db.VarChar(200)
  uagent_version       String       @db.VarChar(100)
  uagent_os            String       @db.VarChar(100)
  uagent_device_vendor String?      @db.VarChar(200)
  uagent_device_type   String?      @db.VarChar(200)
  uagent_device_model  String?      @db.VarChar(200)
  last_seen            Int
  expires              Int

  @@index([member_id])
}

model core_admin_sessions {
  refresh_token        String       @id @unique @db.VarChar(255)
  access_token         String?      @unique @db.VarChar(255)
  member               core_members @relation("core_admin_sessions_member", references: [id], fields: [member_id])
  member_id            String
  ip_address           String?      @db.VarChar(46)
  user_agent           String       @db.Text
  uagent_browser       String       @db.VarChar(200)
  uagent_version       String       @db.VarChar(100)
  uagent_os            String       @db.VarChar(100)
  uagent_device_vendor String?      @db.VarChar(200)
  uagent_device_type   String?      @db.VarChar(200)
  uagent_device_model  String?      @db.VarChar(200)
  last_seen            Int
  expires              Int

  @@index([member_id])
}

model core_attachments {
  id          String       @id @default(uuid())
  extension   String       @db.VarChar(50)
  name        String       @db.VarChar(255)
  url         String       @db.VarChar(255)
  member      core_members @relation("core_attachments_member", references: [id], fields: [member_id])
  member_id   String
  created     Int
  file_size   Int
  position    Int
  description String?      @db.VarChar(255)
  module      String
  module_id   String
  mimetype    String

  members_with_avatar core_members[] @relation("core_members_avatar")
  members_with_cover  core_members[] @relation("core_members_cover")

  @@index([member_id])
}

model forum_forums {
  id          String  @id @unique @default(uuid())
  created     Int
  parent_id   String?
  position    Int     @default(0)
  is_category Boolean @default(false)
  views       Int     @default(0)

  parent      forum_forums?              @relation("forums_forums_parent", references: [id], fields: [parent_id], onDelete: Cascade)
  children    forum_forums[]             @relation("forums_forums_parent")
  name        forum_forums_names[]       @relation("forums_forums_names_forum")
  description forum_forums_description[] @relation("forums_forums_description_forum")
}

model forum_forums_names {
  id          String @id @unique @default(uuid())
  id_language String @db.VarChar(32)
  forum_id    String
  value       String @db.VarChar(255)

  forum    forum_forums   @relation("forums_forums_names_forum", references: [id], fields: [forum_id], onDelete: Cascade)
  language core_languages @relation("forums_forums_names_language", references: [id], fields: [id_language])

  @@index([id_language])
}

model forum_forums_description {
  id          String @id @unique @default(uuid())
  id_language String @db.VarChar(32)
  forum_id    String
  value       String @db.Text

  forum    forum_forums   @relation("forums_forums_description_forum", references: [id], fields: [forum_id], onDelete: Cascade)
  language core_languages @relation("forums_forums_description_language", references: [id], fields: [id_language])

  @@index([id_language])
}
